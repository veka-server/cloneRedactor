/* ------------------------------------------------------------------------------------------------------
 *
 *  CLONEREDACTOR
 *
 * ---------------------------------------------------------------------------------------------------- */
/*
 *  CONFIGURATION
 */

    // url vers la page d'upload pour les images
    var url_upload = 'http://.../upload.php';


/* ---------------------------------------------------------------------------------------------------- */
var ready=(function(){var i,g,l={};l["[object Boolean]"]="boolean";l["[object Number]"]="number";l["[object String]"]="string";l["[object Function]"]="function";l["[object Array]"]="array";l["[object Date]"]="date";l["[object RegExp]"]="regexp";l["[object Object]"]="object";var k={isReady:false,readyWait:1,holdReady:function(a){if(a){k.readyWait++}else{k.ready(true)}},ready:function(a){if((a===true&&!--k.readyWait)||(a!==true&&!k.isReady)){if(!document.body){return setTimeout(k.ready,1)}k.isReady=true;if(a!==true&&--k.readyWait>0){return}i.resolveWith(document,[k])}},bindReady:function(){if(i){return}i=k._Deferred();if(document.readyState==="complete"){return setTimeout(k.ready,1)}if(document.addEventListener){document.addEventListener("DOMContentLoaded",g,false);window.addEventListener("load",k.ready,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",g);window.attachEvent("onload",k.ready);var b=false;try{b=window.frameElement==null}catch(a){}if(document.documentElement.doScroll&&b){h()}}}},_Deferred:function(){var b=[],a,d,c,e={done:function(){if(!c){var f=arguments,v,s,t,u,r;if(a){r=a;a=0}for(v=0,s=f.length;v<s;v++){t=f[v];u=k.type(t);if(u==="array"){e.done.apply(e,t)}else{if(u==="function"){b.push(t)}}}if(r){e.resolveWith(r[0],r[1])}}return this},resolveWith:function(f,n){if(!c&&!a&&!d){n=n||[];d=1;try{while(b[0]){b.shift().apply(f,n)}}finally{a=[f,n];d=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return !!(d||a)},cancel:function(){c=1;b=[];return this}};return e},type:function(a){return a==null?String(a):l[Object.prototype.toString.call(a)]||"object"}};function h(){if(k.isReady){return}try{document.documentElement.doScroll("left")}catch(a){setTimeout(h,1);return}k.ready()}if(document.addEventListener){g=function(){document.removeEventListener("DOMContentLoaded",g,false);k.ready()}}else{if(document.attachEvent){g=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",g);k.ready()}}}}function j(a){k.bindReady();var b=k.type(a);i.done(a)}return j})();ready(function(){var c="";if(!document.getElementById("shadow")){var e=document.createElement("div");e.id="shadow";document.body.appendChild(e)}Element.prototype.center=function(){this.style.position="fixed";this.style.top=Math.max(0,((window.innerHeight/2)-(this.offsetHeight/2)))+"px";this.style.left=Math.max(0,((window.innerWidth/2)-(this.offsetWidth/2)))+"px"};Element.prototype.show=function(){this.style.display="block"};Element.prototype.hide=function(){this.style.display="none"};Element.prototype.popup_open=function(){if(document.getElementById(c)){document.getElementById(c).popup_close()}c=this.id;document.getElementById("shadow").show();document.getElementById(c).show()};var d=setInterval(function(){if(document.getElementById(c)){document.getElementById(c).center()}},100);Element.prototype.popup_close=function(){this.hide();document.getElementById("shadow").hide()};var a=document.getElementsByClassName("popup_open");for(var b=0;b<a.length;b++){a[b].onclick=function(){var f=this.getAttribute("data-popup-src");var g=document.getElementById(f);g.popup_open()}}var a=document.getElementsByClassName("popup_close");for(var b=0;b<a.length;b++){a[b].onclick=function(){var f=this.getAttribute("data-popup-src");var g=document.getElementById(f);g.popup_close()}}document.getElementById("shadow").onclick=function(){document.getElementById(c).popup_close()}});function confirmation(a){if(confirm(a)){return 0}else{return 1}}function post_to_url(b,d,f){f=f||"post";var c=new FormData();for(var a in d){if(typeof d[a]!=="function"){c.append(a,d[a])}}var e=new XMLHttpRequest();e.open(f,url_upload,false);e.send(c);return e.responseText}Element.prototype.addClass=function(a){this.className+=" "+a};Element.prototype.removeClass=function(a){this.className=this.className.replace("#(?:^|s)"+a+"(?!S)#g","")};function enregistrer_selection(){savedRange=window.getSelection().getRangeAt(0)}function restorer_selection(){window.getSelection().removeAllRanges();window.getSelection().addRange(savedRange)}function creer_selection(d,a,f,c){var b=document.createRange();b.setStart(d,a);b.setEnd(f,c);var e=window.getSelection();e.removeAllRanges();e.addRange(b)}function selectAllNode(a){creer_selection(a,0,a,a.textContent.length)}function nodeFocus(a){a.focus()}function issetId(b){var a=document.getElementById(b);if(a){return 1}return 0}function getStringAfterLastMotif(b,a){return b.substr(b.lastIndexOf(a)+1)}var lastId=0;var savedRange="";var ajout_popup=0;var linkNode="";function cloneRedactor(o,f){function k(){return lastId++}function m(B){var z=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000","none"];var A="";for(var y=0;y<z.length;y++){A+='<input type="button" name="color-'+B+'" class="color-'+(y+1)+'" data-commandValue="'+z[y]+'">'}return A}function p(y){var A=document.getElementsByName("ewysiwyg").length-1;for(var z=0;z<=A;z++){if(y!=z){document.getElementById("div_editor_"+z).contentEditable="false"}}}function d(A,z,y,i){p(i);document.execCommand(A,z,y);nodeFocus(document.getElementById("div_editor_"+i));q()}function q(){var z=document.getElementsByName("ewysiwyg").length-1;for(var y=0;y<=z;y++){document.getElementById("div_editor_"+y).contentEditable="true"}}function j(){var z=document.getElementsByName("DIVcolorpicker");for(var B=0;B<z.length;B++){if(z[B].style.display=="block"){z[B].style.display="none";var y=getStringAfterLastMotif(z[B].id,"_");var A=document.getElementById("forecolor_"+y);A.className=A.className.replace(" active","")}}}function v(){var z=document.getElementsByName("DIVformat");for(var A=0;A<z.length;A++){if(z[A].style.display=="block"){z[A].style.display="none";var y=getStringAfterLastMotif(z[A].id,"_");var B=document.getElementById("format_"+y);B.className=B.className.replace("active","")}}}document.body.onclick=function(A){var B=A?A.target:event.srcElement;var y=["forecolor_","DIVcolorpicker_","format_","DIVformat_"];for(var z=0;z<y.length;z++){if(B.id.search(y[z])!=-1){return 0}}j();v()};var n=k();config_outils_title={html:"switch",bold:"gras",italic:"italique",underline:"sousligner",rayer:"rayer",link:"creer un lien",unlink:"supprimer un lien",picture:"creer une image",color:"changer la couleur du texte",orderedlist:"liste ordonné",unorderedlist:"liste non ordonné",alignleft:"aligner a gauche",aligncenter:"aligner au centre",alignright:"aligner a droite",justify:"justifier",format:"format du texte",undo:"annuler la derni&egrave;re action",redo:"retablir la derni&egrave;re action",format:"paragraphe"};if(f==undefined){var f=["html","|","format","|","undo","redo","|","bold","italic","underline","rayer","|","link","unlink","picture","|","color","|","orderedlist","unorderedlist","|","alignleft","aligncenter","alignright","justify"]}var g="";for(var t=0;t<f.length;t++){switch(f[t]){case"|":g+='<div class="separateur"></div>';break;case"format":g+='<div style="float:left;position:relative;"><input type="button" title="'+config_outils_title.format+'" class="icon-wysiwyg-format" id="format_'+n+'"><div id="DIVformat_'+n+'" name="DIVformat" style="display:none"><input name="format-button_'+n+'" value="Paragraphe" data-commandvalue="p" type="button"/><input name="format-button_'+n+'" value="Code" data-commandvalue="pre" type="button"/><input name="format-button_'+n+'" value="Titre 1" data-commandvalue="h1" type="button"/><input name="format-button_'+n+'" value="Titre 2" data-commandvalue="h2" type="button"/><input name="format-button_'+n+'" value="Titre 3" data-commandvalue="h3" type="button"/><input name="format-button_'+n+'" value="Titre 4" data-commandvalue="h4" type="button"/><input name="format-button_'+n+'" value="Titre 5" data-commandvalue="h5" type="button"/></div></div>';break;case"color":var u=m("forecolor_"+n);g+='<div style="float:left;position:relative;"><input title="'+config_outils_title.color+'" type="button" class="icon-wysiwyg-color forecolor" id="forecolor_'+n+'"><div id="DIVcolorpicker_'+n+'" style="display:none;" name="DIVcolorpicker">'+u+"</div></div>";break;default:g+='<input id="'+f[t]+"_"+n+'" class="icon-wysiwyg-'+f[t]+'" type="button" title="'+config_outils_title[f[t]]+'">';break}}if(ajout_popup==0){g+='<div class="popup" id="popup_link"><h1>Inserer un lien</h1>URL : <input type="url" id="url-lien" class="inputlien" placeholder="lien ves la page" ><input type="button" class="btn btn-primary" value="Valider" id="creer_link"></div>';g+='<div class="popup" id="popup_image"><h1>Inserer une image</h1>Url : <input type="url" id="url-image" class="inputlien" placeholder="lien vers l\'image" ><br><br><span class="muted">Ou s&eacute;l&eacute;ctionnez un fichier local :</span><br><input type="file"  name="image" id="upload_image" style="display:none;"><input type="button" class="button_upload btn btn-warning" id="btn_upload_image" value="Heberger une image"/><div id="store_uploadimgjhfgbd"></div><br><input type="button" class="btn btn-primary" value="Valider" id="creer_image"></div>';ajout_popup++}o.insertAdjacentHTML("afterend",'<div id="editor_'+n+'" name="ewysiwyg" style="display:none;"><div id="outils_'+n+'">'+g+'</div><div id="div_editor_'+n+'">'+o.value+'</div><textarea id="textarea_editor_'+n+'"></textarea></div>');var c=document.getElementById("textarea_editor_"+n+"");var e=document.getElementById("editor_"+n+"");var a=document.getElementById("div_editor_"+n+"");var w=document.getElementById("DIVcolorpicker_"+n+"");var r=document.getElementById("DIVbackcolorpicker_"+n+"");e.style.minHeight=o.offsetHeight-14+"px";a.style.minHeight=o.offsetHeight-14+"px";c.style.minHeight=o.offsetHeight-14+"px";e.style.width=o.offsetWidth-14+"px";c.style.display="none";a.contentEditable="true";o.style.display="none";e.style.display="block";var l={alignleft:"justifyleft",alignright:"justifyright",aligncenter:"justifycenter",justify:"justifyfull",unorderedlist:"insertunorderedlist",orderedlist:"insertorderedlist",bold:"bold",underline:"underline",italic:"italic",unlink:"unlink",rayer:"strikethrough",undo:"undo",redo:"redo"};for(var x in l){if(issetId(x+"_"+n)){document.getElementById(x+"_"+n).onclick=function(){var i=getStringAfterLastMotif(this.id,"_");d(l[this.id.replace("_"+i,"")],false,"",i)}}}var b=document.getElementsByName("format-button_"+n);for(var t=0;t<b.length;t++){b[t].onclick=function(){var y=this.getAttribute("data-commandvalue");var i=getStringAfterLastMotif(this.name,"_");d("formatBlock",false,y,i)}}if(issetId("format_"+n)){document.getElementById("format_"+n).onclick=function(){var i=document.getElementById("DIVformat_"+n);if(i.style.display=="none"){v();i.style.display="block";this.className+=" active"}else{v()}}}var b=document.getElementsByName("color-forecolor_"+n);for(var t=0;t<b.length;t++){b[t].onclick=function(){var y=this.getAttribute("data-commandvalue");var i=getStringAfterLastMotif(this.name,"_");d("forecolor",false,y,i)}}if(issetId("forecolor_"+n)){document.getElementById("forecolor_"+n).onclick=function(){if(w.style.display=="none"){j();w.style.display="block";this.className+=" active"}else{j()}}}if(issetId("link_"+n)){var h="";document.getElementById("picture_"+n).onclick=function(){enregistrer_selection();h=getStringAfterLastMotif(this.id,"_");document.getElementById("popup_image").popup_open();document.getElementById("btn_upload_image").onclick=function(){document.getElementById("upload_image").click()};document.getElementById("upload_image").onchange=function(z){var y=z.target.files[0];var i=new FileReader();i.onload=function(D){var B=document.getElementById("store_uploadimgjhfgbd");if(y.type.search("image")!=-1){if(B.innerHTML==""){B.addClass("dsib");var A=document.createElement("img");A.src=D.target.result;B.appendChild(A)}else{var A=document.getElementById("store_uploadimgjhfgbd").getElementsByTagName("img")[0];A.src=D.target.result}var E={fichier:z.target.files[0]};var C=post_to_url(url_upload,E);document.getElementById("url-image").value=C}else{B.innerHTML="";document.getElementById("url-image").value="";alert("Seul les images sont autorisé")}};i.readAsDataURL(y)}}}if(issetId("creer_image")){document.getElementById("creer_image").onclick=function(){var i=document.getElementById("url-image").value;document.getElementById("popup_image").popup_close();if(i!=""){restorer_selection();d("insertimage",false,i,h)}}}if(issetId("link_"+n)){var h="";document.getElementById("link_"+n).onclick=function(){enregistrer_selection();h=getStringAfterLastMotif(this.id,"_");document.getElementById("popup_link").popup_open()}}if(issetId("creer_link")){document.getElementById("creer_link").onclick=function(){var i=document.getElementById("url-lien").value;document.getElementById("popup_link").popup_close();if(i!=""){if(typeof linkNode=="object"){linkNode.href=i;delete linkNode}else{restorer_selection();d("createlink",false,i,h)}}}}if(issetId("html_"+n)){document.getElementById("html_"+n).onclick=function(){if(c.style.display=="none"){this.className+=" active";c.value=a.innerHTML;c.style.height=a.offsetHeight-14+"px";c.style.width=a.offsetWidth-14+"px";c.style.display="block";a.style.display="none"}else{this.className=this.className.replace(" active","");a.innerHTML=c.value;c.style.display="none";a.style.display="block"}}}a.onclick=function(){var i=window.getSelection().getRangeAt(0);var y=i.startContainer.parentNode;var A="";while(y){A="."+y.tagName;if(A.toLowerCase()==".a"){break}else{y=y.parentNode}}if(A.toLowerCase()==".a"){linkNode=y;var z=linkNode.href;document.getElementById("url-lien").value=z;document.getElementById("popup_link").popup_open()}};var s=a.innerHTML;setInterval(function(){var i=a.innerHTML;if(i!=s){o.innerHTML=a.innerHTML;s=i}},500)}ready(function(){var c=document.getElementsByClassName("cloneRedactor");for(var b=0;b<c.length;b++){if(c[b].getAttribute("data-outils")){var a=c[b].getAttribute("data-outils").split(",");cloneRedactor(c[b],a)}else{cloneRedactor(c[b])}}});