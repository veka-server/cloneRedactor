/* ------------------------------------------------------------------------------------------------------
 *
 *  CLONEREDACTOR
 *
 * ---------------------------------------------------------------------------------------------------- */
/*
 *  CONFIGURATION
 */

    // url vers la page d'upload pour les images
    var url_upload = 'http://.../upload.php';


/* ---------------------------------------------------------------------------------------------------- */
var ready=(function(){var i,g,l={};l["[object Boolean]"]="boolean";l["[object Number]"]="number";l["[object String]"]="string";l["[object Function]"]="function";l["[object Array]"]="array";l["[object Date]"]="date";l["[object RegExp]"]="regexp";l["[object Object]"]="object";var k={isReady:false,readyWait:1,holdReady:function(a){if(a){k.readyWait++}else{k.ready(true)}},ready:function(a){if((a===true&&!--k.readyWait)||(a!==true&&!k.isReady)){if(!document.body){return setTimeout(k.ready,1)}k.isReady=true;if(a!==true&&--k.readyWait>0){return}i.resolveWith(document,[k])}},bindReady:function(){if(i){return}i=k._Deferred();if(document.readyState==="complete"){return setTimeout(k.ready,1)}if(document.addEventListener){document.addEventListener("DOMContentLoaded",g,false);window.addEventListener("load",k.ready,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",g);window.attachEvent("onload",k.ready);var b=false;try{b=window.frameElement==null}catch(a){}if(document.documentElement.doScroll&&b){h()}}}},_Deferred:function(){var b=[],a,d,c,e={done:function(){if(!c){var f=arguments,v,s,t,u,r;if(a){r=a;a=0}for(v=0,s=f.length;v<s;v++){t=f[v];u=k.type(t);if(u==="array"){e.done.apply(e,t)}else{if(u==="function"){b.push(t)}}}if(r){e.resolveWith(r[0],r[1])}}return this},resolveWith:function(f,n){if(!c&&!a&&!d){n=n||[];d=1;try{while(b[0]){b.shift().apply(f,n)}}finally{a=[f,n];d=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return !!(d||a)},cancel:function(){c=1;b=[];return this}};return e},type:function(a){return a==null?String(a):l[Object.prototype.toString.call(a)]||"object"}};function h(){if(k.isReady){return}try{document.documentElement.doScroll("left")}catch(a){setTimeout(h,1);return}k.ready()}if(document.addEventListener){g=function(){document.removeEventListener("DOMContentLoaded",g,false);k.ready()}}else{if(document.attachEvent){g=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",g);k.ready()}}}}function j(a){k.bindReady();var b=k.type(a);i.done(a)}return j})();ready(function(){var c="";if(!document.getElementById("shadow")){var e=document.createElement("div");e.id="shadow";document.body.appendChild(e)}Element.prototype.center=function(){this.style.position="fixed";this.style.top=Math.max(0,((window.innerHeight/2)-(this.offsetHeight/2)))+"px";this.style.left=Math.max(0,((window.innerWidth/2)-(this.offsetWidth/2)))+"px"};Element.prototype.show=function(){this.style.display="block"};Element.prototype.hide=function(){this.style.display="none"};Element.prototype.popup_open=function(){if(document.getElementById(c)){document.getElementById(c).popup_close()}c=this.id;document.getElementById("shadow").show();document.getElementById(c).show()};var d=setInterval(function(){if(document.getElementById(c)){document.getElementById(c).center()}},100);Element.prototype.popup_close=function(){this.hide();document.getElementById("shadow").hide()};var a=document.getElementsByClassName("popup_open");for(var b=0;b<a.length;b++){a[b].onclick=function(){var f=this.getAttribute("data-popup-src");var g=document.getElementById(f);g.popup_open()}}var a=document.getElementsByClassName("popup_close");for(var b=0;b<a.length;b++){a[b].onclick=function(){var f=this.getAttribute("data-popup-src");var g=document.getElementById(f);g.popup_close()}}document.getElementById("shadow").onclick=function(){document.getElementById(c).popup_close()}});function argsToArray(a){var c=[];for(var b=0;b<a.length;b++){c.push(a[b])}return c}function confirmation(a){if(confirm(a)){return 0}else{return 1}}function post_to_url(b,d,f){f=f||"post";var c=new FormData();for(var a in d){if(typeof d[a]!=="function"){c.append(a,d[a])}}var e=new XMLHttpRequest();e.open(f,url_upload,false);e.send(c);return e.responseText}Element.prototype.addClass=function(a){this.className+=" "+a};Element.prototype.removeClass=function(a){this.className=this.className.replace("#(?:^|s)"+a+"(?!S)#g","")};function enregistrer_selection(){savedRange=window.getSelection().getRangeAt(0)}function restorer_selection(){window.getSelection().removeAllRanges();window.getSelection().addRange(savedRange)}function creer_selection(d,a,f,c){var b=document.createRange();b.setStart(d,a);b.setEnd(f,c);var e=window.getSelection();e.removeAllRanges();e.addRange(b)}function selectAllNode(a){creer_selection(a,0,a,a.textContent.length)}function nodeFocus(a){a.focus()}function issetId(b){var a=document.getElementById(b);if(a){return 1}return 0}function getStringAfterLastMotif(b,a){return b.substr(b.lastIndexOf(a)+1)}var lastId=0;var savedRange="";var ajout_popup=0;var linkNode="";function cloneRedactor(n,e){function j(){return lastId++}function l(A){var y=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000","none"];var z="";for(var x=0;x<y.length;x++){z+='<input type="button" name="color-'+A+'" class="color-'+(x+1)+'" data-commandValue="'+y[x]+'">'}return z}function o(x){var z=document.getElementsByName("ewysiwyg").length-1;for(var y=0;y<=z;y++){if(x!=y){document.getElementById("div_editor_"+y).contentEditable="false"}}}function c(z,y,x,i){o(i);document.execCommand(z,y,x);nodeFocus(document.getElementById("div_editor_"+i));p()}function p(){var y=document.getElementsByName("ewysiwyg").length-1;for(var x=0;x<=y;x++){document.getElementById("div_editor_"+x).contentEditable="true"}}function h(){argsToArray(document.getElementsByName("DIVcolorpicker")).forEach(function(z,y,A){if(z.style.display=="block"){z.style.display="none";var i=getStringAfterLastMotif(z.id,"_");var x=document.getElementById("forecolor_"+i);x.className=x.className.replace(" active","")}})}function u(){argsToArray(document.getElementsByName("DIVformat")).forEach(function(y,x,A){if(y.style.display=="block"){y.style.display="none";var i=getStringAfterLastMotif(y.id,"_");var z=document.getElementById("format_"+i);z.className=z.className.replace("active","")}})}document.body.onclick=function(z){var A=z?z.target:event.srcElement;var x=["forecolor_","DIVcolorpicker_","format_","DIVformat_"];for(var y=0;y<x.length;y++){if(A.id.search(x[y])!=-1){return 0}}h();u()};var m=j();config_outils_title={html:"switch",bold:"gras",italic:"italique",underline:"sousligner",rayer:"rayer",link:"creer un lien",unlink:"supprimer un lien",picture:"creer une image",color:"changer la couleur du texte",orderedlist:"liste ordonné",unorderedlist:"liste non ordonné",alignleft:"aligner a gauche",aligncenter:"aligner au centre",alignright:"aligner a droite",justify:"justifier",format:"format du texte",undo:"annuler la derni&egrave;re action",redo:"retablir la derni&egrave;re action",format:"paragraphe"};if(e==undefined){var e=["html","|","format","|","undo","redo","|","bold","italic","underline","rayer","|","link","unlink","picture","|","color","|","orderedlist","unorderedlist","|","alignleft","aligncenter","alignright","justify"]}var f="";for(var s=0;s<e.length;s++){switch(e[s]){case"|":f+='<div class="separateur"></div>';break;case"format":f+='<div style="float:left;position:relative;"><input type="button" title="'+config_outils_title.format+'" class="icon-wysiwyg-format" id="format_'+m+'"><div id="DIVformat_'+m+'" name="DIVformat" style="display:none"><input name="format-button_'+m+'" value="Paragraphe" data-commandvalue="p" type="button"/><input name="format-button_'+m+'" value="Code" data-commandvalue="pre" type="button"/><input name="format-button_'+m+'" value="Titre 1" data-commandvalue="h1" type="button"/><input name="format-button_'+m+'" value="Titre 2" data-commandvalue="h2" type="button"/><input name="format-button_'+m+'" value="Titre 3" data-commandvalue="h3" type="button"/><input name="format-button_'+m+'" value="Titre 4" data-commandvalue="h4" type="button"/><input name="format-button_'+m+'" value="Titre 5" data-commandvalue="h5" type="button"/></div></div>';break;case"color":var t=l("forecolor_"+m);f+='<div style="float:left;position:relative;"><input title="'+config_outils_title.color+'" type="button" class="icon-wysiwyg-color forecolor" id="forecolor_'+m+'"><div id="DIVcolorpicker_'+m+'" style="display:none;" name="DIVcolorpicker">'+t+"</div></div>";break;default:f+='<input id="'+e[s]+"_"+m+'" class="icon-wysiwyg-'+e[s]+'" type="button" title="'+config_outils_title[e[s]]+'">';break}}if(ajout_popup==0){f+='<div class="popup" id="popup_link"><h1>Inserer un lien</h1>URL : <input type="url" id="url-lien" class="inputlien" placeholder="lien ves la page" ><input type="button" class="btn btn-primary" value="Valider" id="creer_link"></div>';f+='<div class="popup" id="popup_image"><h1>Inserer une image</h1>Url : <input type="url" id="url-image" class="inputlien" placeholder="lien vers l\'image" ><br><br><span class="muted">Ou s&eacute;l&eacute;ctionnez un fichier local :</span><br><input type="file"  name="image" id="upload_image" style="display:none;"><input type="button" class="button_upload btn btn-warning" id="btn_upload_image" value="Heberger une image"/><div id="store_uploadimgjhfgbd"></div><br><input type="button" class="btn btn-primary" value="Valider" id="creer_image"></div>';ajout_popup++}n.insertAdjacentHTML("afterend",'<div id="editor_'+m+'" name="ewysiwyg" style="display:none;"><div id="outils_'+m+'">'+f+'</div><div id="div_editor_'+m+'">'+n.value+'</div><textarea id="textarea_editor_'+m+'"></textarea></div>');var b=document.getElementById("textarea_editor_"+m+"");var d=document.getElementById("editor_"+m+"");var a=document.getElementById("div_editor_"+m+"");var v=document.getElementById("DIVcolorpicker_"+m+"");var q=document.getElementById("DIVbackcolorpicker_"+m+"");d.style.minHeight=n.offsetHeight-14+"px";a.style.minHeight=n.offsetHeight-14+"px";b.style.minHeight=n.offsetHeight-14+"px";d.style.width=n.offsetWidth-14+"px";b.style.display="none";a.contentEditable="true";n.style.display="none";d.style.display="block";var k={alignleft:"justifyleft",alignright:"justifyright",aligncenter:"justifycenter",justify:"justifyfull",unorderedlist:"insertunorderedlist",orderedlist:"insertorderedlist",bold:"bold",underline:"underline",italic:"italic",unlink:"unlink",rayer:"strikethrough",undo:"undo",redo:"redo"};for(var w in k){if(issetId(w+"_"+m)){document.getElementById(w+"_"+m).onclick=function(){var i=getStringAfterLastMotif(this.id,"_");c(k[this.id.replace("_"+i,"")],false,"",i)}}}argsToArray(document.getElementsByName("format-button_"+m)).forEach(function(x,i,y){x.onclick=function(){var A=this.getAttribute("data-commandvalue");var z=getStringAfterLastMotif(this.name,"_");c("formatBlock",false,A,z)}});if(issetId("format_"+m)){document.getElementById("format_"+m).onclick=function(){var i=document.getElementById("DIVformat_"+m);if(i.style.display=="none"){u();i.style.display="block";this.className+=" active"}else{u()}}}argsToArray(document.getElementsByName("color-forecolor_"+m)).forEach(function(x,i,y){x.onclick=function(){var A=this.getAttribute("data-commandvalue");var z=getStringAfterLastMotif(this.name,"_");c("forecolor",false,A,z)}});if(issetId("forecolor_"+m)){document.getElementById("forecolor_"+m).onclick=function(){if(v.style.display=="none"){h();v.style.display="block";this.className+=" active"}else{h()}}}if(issetId("link_"+m)){var g="";document.getElementById("picture_"+m).onclick=function(){enregistrer_selection();g=getStringAfterLastMotif(this.id,"_");document.getElementById("popup_image").popup_open();document.getElementById("btn_upload_image").onclick=function(){document.getElementById("upload_image").click()};document.getElementById("upload_image").onchange=function(y){var x=y.target.files[0];var i=new FileReader();i.onload=function(C){var A=document.getElementById("store_uploadimgjhfgbd");if(x.type.search("image")!=-1){if(A.innerHTML==""){A.addClass("dsib");var z=document.createElement("img");z.src=C.target.result;A.appendChild(z)}else{var z=document.getElementById("store_uploadimgjhfgbd").getElementsByTagName("img")[0];z.src=C.target.result}var D={fichier:y.target.files[0]};var B=post_to_url(url_upload,D);document.getElementById("url-image").value=B}else{A.innerHTML="";document.getElementById("url-image").value="";alert("Seul les images sont autorisé")}};i.readAsDataURL(x)}}}if(issetId("creer_image")){document.getElementById("creer_image").onclick=function(){var i=document.getElementById("url-image").value;document.getElementById("popup_image").popup_close();if(i!=""){restorer_selection();c("insertimage",false,i,g)}}}if(issetId("link_"+m)){var g="";document.getElementById("link_"+m).onclick=function(){enregistrer_selection();g=getStringAfterLastMotif(this.id,"_");document.getElementById("popup_link").popup_open()}}if(issetId("creer_link")){document.getElementById("creer_link").onclick=function(){var i=document.getElementById("url-lien").value;document.getElementById("popup_link").popup_close();if(i!=""){if(typeof linkNode=="object"){linkNode.href=i;delete linkNode}else{restorer_selection();c("createlink",false,i,g)}}}}if(issetId("html_"+m)){document.getElementById("html_"+m).onclick=function(){if(b.style.display=="none"){this.className+=" active";b.value=a.innerHTML;b.style.height=a.offsetHeight-14+"px";b.style.width=a.offsetWidth-14+"px";b.style.display="block";a.style.display="none"}else{this.className=this.className.replace(" active","");a.innerHTML=b.value;b.style.display="none";a.style.display="block"}}}a.onclick=function(){var i=window.getSelection().getRangeAt(0);var x=i.startContainer.parentNode;var z="";while(x){z="."+x.tagName;if(z.toLowerCase()==".a"){break}else{x=x.parentNode}}if(z.toLowerCase()==".a"){linkNode=x;var y=linkNode.href;document.getElementById("url-lien").value=y;document.getElementById("popup_link").popup_open()}};var r=a.innerHTML;setInterval(function(){var i=a.innerHTML;if(i!=r){n.innerHTML=a.innerHTML;r=i}},500)}ready(function(){argsToArray(document.getElementsByClassName("cloneRedactor")).forEach(function(c,b,d){if(c.getAttribute("data-outils")){var a=c.getAttribute("data-outils").split(",");cloneRedactor(c,a)}else{cloneRedactor(c)}})});